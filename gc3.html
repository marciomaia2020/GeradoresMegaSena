<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Combinações - Mega Sena (3 Dígitos)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SheetJS para exportação Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
	
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1B9A67',
                        'mega-green': '#1B9A67',
                        'mega-light-green': '#2BAE73',
                        'mega-dark-green': '#149954',
                        'mega-cream': '#F0FFF4'
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
<style>
 body, html {
        height: 100%;
        margin: 0;
    }

    .menu-centro {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem 0;
        gap: 2rem;
    }

    .menu-analises {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .menu-numeros {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5rem;
        max-width: 600px;
    }

    .link-analise {
        text-decoration: none;
        color: black;
        padding: 12px 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        border: 2px solid #e9ecef;
        font-weight: 600;
        text-align: center;
        min-width: 180px;
        display: block;
    }
	   .link-analise1 {
        text-decoration: none;
        color: green;
        padding: 12px 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        border: 2px solid #e9ecef;
        font-weight: 600;
        text-align: center;
        min-width: 180px;
        display: block;
    }

    .link-numero {
        text-decoration: none;
        color: black;
        padding: 8px 12px;
        border-radius: 6px;
        transition: all 0.3s ease;
        background-color: #f8f9fa;
        border: 2px solid #e9ecef;
        font-weight: 600;
        text-align: center;
        min-width: 40px;
        display: block;
    }

    .link-analise:hover,
    .link-numero:hover {
        animation: alternaCores 1s infinite alternate;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
	.link-analise1:hover,
    .link-numero:hover {
        animation: alternaCores 1s infinite alternate;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    @keyframes alternaCores {
        0% {
            background-color: #e6f7ff;
        }
        100% {
            background-color: #1B9A67;
        }
    }

    /* Dark mode styles */
    .dark .link-analise,
    .dark .link-numero {
        background-color: #374151;
        border-color: #4b5563;
        color: #f9fafb;
    }

    .dark .link-analise:hover,
    .dark .link-numero:hover {
        animation: alternaCoresdark 1s infinite alternate;
    }


    @keyframes alternaCoresdark {
        0% {
            background-color: #064e3b;
        }
        100% {
            background-color: #1B9A67;
        }
    }
</style>

</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Detecção de tema escuro -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Layout com sidebar e conteúdo principal -->
    <div class="flex flex-col md:flex-row">
        <!-- Barra lateral com links -->
        <div class="w-full md:w-64 bg-gray-100 dark:bg-gray-800 p-4 md:min-h-screen">
            <div class="mb-6">
                <h3 class="text-lg font-bold mb-3 text-primary dark:text-green-400">Ferramentas Mega Sena</h3>
                <div class="space-y-1">
                    <a href="./index.html" class="block py-1 px-2 rounded bg-primary/10 text-primary dark:text-green-400 font-bold">Gerador de Combinações</a>
                    
					<div class="mt-3 mb-1 text-sm font-bold text-gray-600 dark:text-gray-400">ANÁLISES PRINCIPAIS</div>
					<a href="./ResultadosDigitosMegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Resultados Dígitos</a>
					<a href="./AnaliseCombinacoesMS/" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Análise por Combinação</a>
                    <a href="./AnalisadorCombinacoesJogosMS/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Analisador Combinações</a>
                    <a href="./MegaSenaConferidor/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Conferidor Mega Sena</a>
					<a href="./MegaSenaConferidor1/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Conferidor (Específico)</a>

					<div class="mt-3 mb-1 text-sm font-bold text-gray-600 dark:text-gray-400">ESTRATÉGIAS</div>
                    <a href="./CombinacaoDoisMegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Combinação Dígitos</a>
					<a href="./AnaliseCombinacoesResultadosMS/" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Análise de Combinações</a>
                    <a href="./ConfAutoMaisQue1MegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Conferidor Automático</a>
					<a href="./ResumoMegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Resumo</a>
                    <a href="./MegaSenaEstrategias/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Estratégias</a>
                    <a href="./GeradorFinalMegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Gerador Final</a>
					
					<div class="mt-3 mb-1 text-sm font-bold text-gray-600 dark:text-gray-400">DÍGITOS</div>
                    <a href="./GeradorBaseadoEmDigitosMegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Baseado em Dígitos</a>
                    
					<div class="mt-3 mb-1 text-sm font-bold text-gray-600 dark:text-gray-400">CALCULADORA</div>
                    <a href="./CalculadoraCustoMS/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Calculadora de Custos</a>

                    <div class="mt-3 mb-1 text-sm font-bold text-gray-600 dark:text-gray-400">CONFERIDORES</div>
                    <a href="./ConfAuto1MegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Conferidor Automático 1</a>
                    
                    <div class="mt-3 mb-1 text-sm font-bold text-gray-600 dark:text-gray-400">ANÁLISES AVANÇADAS</div>
                    <a href="./MegaSenaDesdobramento/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Desdobramento</a>
                    <a href="./ResultadosAlteradosMegaSena/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Resultados Alterados</a>
                    
                    <div class="mt-3 mb-1 text-sm font-bold text-gray-600 dark:text-gray-400">OUTROS</div>
                    <a href="./MegaSenaCal/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Calculadora</a>
                    <a href="./MegaSenaCom/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Comissão</a>
                    <a href="./MegaSenaCur/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Curiosidades</a>
                    <a href="./MegaSenaIa/index.html" target="_blank" class="block py-1 px-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700">Inteligência Artificial</a>
                </div>
            </div>
        </div>
		

<!-- Conteúdo principal -->
        <div class="flex-1 p-4">
            <h1 class="text-2xl font-bold text-center mb-6">Gerador de Combinações - Mega Sena (TODAS as combinações)</h1>
            
			<hr />
				<div class="menu-centro">
					<!-- Primeira linha: Links especiais -->
					<div class="menu-analises">
						<a href="index-pares-impares-ms.html/" target="_blank" class="link-analise">Pares Vs Ímpares</a>
						<a href="index-combinacoes-melhores-ms.html/" target="_blank" class="link-analise">Combinações (Melhores)</a>
						<a href="index-combinacoes-todas-ms.html/" target="_blank" class="link-analise1">Combinações (Todas) *</a>
					    <a href="index-combinacoes-analise-ms.html/" target="_blank" class="link-analise1">Combinações (Análise) *</a>
					</div>
					
					<!-- Segunda linha: Números 1-10 -->
					
					<div class="menu-numeros">
					    <p class="intro">Combinações</p>
						<a href="index1-ms.html/" target="_blank" class="link-numero">1</a>
						<a href="index2-ms.html/" target="_blank" class="link-numero">2</a>
						<a href="index3-ms.html/" target="_blank" class="link-numero">3</a>
						<a href="index4-ms.html/" target="_blank" class="link-numero">4</a>
						<a href="index5-ms.html" target="_blank" class="link-numero">5</a>
						<a href="index6-ms.html" target="_blank" class="link-numero">6</a>
						<a href="index7-ms.html/" target="_blank" class="link-numero">7</a>
						<a href="index8-ms.html/" target="_blank" class="link-numero">8</a>
						<a href="index9-ms.html/" target="_blank" class="link-numero">9</a>
						<a href="index10-ms.html/" target="_blank" class="link-numero">10</a>
					</div>
					<!-- Terceira linha: Números Gerador de Combinações do 03 ao 09 -->
				
					<div class="menu-numeros">
						<p class="intro">Gerador Pro</p>
						<a href="gc3-ms.html/" target="_blank" class="link-numero">3</a>
						<a href="#/" target="_blank" class="link-numero">?</a>
						<a href="#/" target="_blank" class="link-numero">?</a>
						<a href="gc4-ms.html/" target="_blank" class="link-numero">4</a>
						<a href="gc5-ms.html" target="_blank" class="link-numero">5</a>
						<a href="gc6-ms.html" target="_blank" class="link-numero">6</a>
						<a href="gc7-ms.html/" target="_blank" class="link-numero">7</a>
						<a href="gc8-ms.html/" target="_blank" class="link-numero">8</a>
						<a href="gc9-ms.html/" target="_blank" class="link-numero">9</a>
						<a href="gc10-ms.html/" target="_blank" class="link-numero">10</a>
					</div>
				</div>
			<hr />

<!-- Header -->
<header class="bg-gradient-to-r from-mega-green to-mega-light-green shadow-lg">
    <div class="container mx-auto px-4 py-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <i class="fas fa-dice text-white text-3xl"></i>
                <div>
                    <h1 class="text-white text-2xl font-bold">Gerador Mega Sena Pro (3 Dígitos)</h1>
                    <p class="text-green-100 text-sm">7.980 jogos - TODAS as 120 combinações de 3 dígitos</p>
                </div>
            </div>
            <div class="text-white text-right">
                <p class="text-sm">Último sorteio:</p>
                <p id="last-draw" class="font-semibold">Carregando...</p>
            </div>
        </div>
    </div>
</header>

<div class="container mx-auto px-4 py-8">
    <!-- Status de Carregamento dos Dados -->
    <div id="data-loading-section" class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
            <i class="fas fa-database text-mega-green mr-3"></i>
            Carregando Dados Históricos Reais
        </h2>
        
        <div class="space-y-4">
            <div class="flex items-center justify-between">
                <span class="text-gray-600 dark:text-gray-300">Buscando TODOS os resultados da Caixa (do concurso 1 ao último)...</span>
                <span id="loading-status" class="text-mega-green font-semibold">Inicializando...</span>
            </div>
            
            <!-- Barra de Progresso -->
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3">
                <div id="progress-bar" class="bg-gradient-to-r from-mega-green to-mega-light-green h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-mega-green" id="loaded-count">0</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Concursos Carregados</div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-green-600" id="cache-status">❌</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Cache Local</div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600" id="api-status">🔄</div>
                    <div class="text-sm text-gray-600 dark:text-gray-400">Status da API</div>
                </div>
            </div>
            
            <div id="data-summary" class="hidden bg-mega-cream dark:bg-gray-900 p-4 rounded-lg border border-mega-green">
                <h3 class="font-semibold text-mega-green mb-3">📊 Dados Carregados com Sucesso!</h3>
                
                <!-- Informações de Cobertura -->
                <div class="bg-white dark:bg-gray-800 p-3 rounded-lg mb-4 border border-green-200 dark:border-gray-700">
                    <h4 class="font-medium text-gray-800 dark:text-white mb-2">🎯 Cobertura dos Dados</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
                        <div class="text-center">
                            <div class="text-lg font-bold text-blue-600" id="total-contests">0</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">Concursos Carregados</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-green-600" id="total-existing">0</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">Total Existente</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-mega-green" id="coverage-percentage">0%</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">Cobertura</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-purple-600" id="missing-count">0</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400">Não Carregados</div>
                        </div>
                    </div>
                </div>
                
                <!-- Informações Detalhadas -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Período Carregado:</span>
                        <div id="period-range" class="text-mega-green font-semibold">-</div>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Mais Sorteado:</span>
                        <div id="most-frequent" class="text-mega-green font-semibold">-</div>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Fonte dos Dados:</span>
                        <div id="data-source" class="text-mega-green font-semibold">API Caixa</div>
                    </div>
                    <div>
                        <span class="font-medium text-gray-700 dark:text-gray-300">Última Atualização:</span>
                        <div id="last-update" class="text-mega-green font-semibold">Agora</div>
                    </div>
                </div>
                
                <!-- Barra de Progresso da Cobertura -->
                <div class="mt-4">
                    <div class="flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1">
                        <span>Cobertura dos Dados Históricos</span>
                        <span id="coverage-text">0 de 0 concursos</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div id="coverage-bar" class="bg-gradient-to-r from-green-500 to-mega-green h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <button id="retry-loading" class="hidden w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors">
                <i class="fas fa-refresh mr-2"></i>
                Tentar Novamente
            </button>
        </div>
    </div>

    <!-- Configuração do Jogo -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
            <i class="fas fa-cog text-mega-green mr-3"></i>
            Configuração dos Jogos (3 Dígitos)
        </h2>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Coluna 1 -->
            <div class="space-y-6">
                <!-- Quantidade de Jogos -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Quantos jogos você pretende fazer?
                    </label>
                    <input type="number" id="num-games" min="10" max="7980" value="7980" placeholder="Digite de 10 a 7.980"
                           class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-mega-green focus:border-transparent dark:bg-gray-700 dark:text-white">
                    <div class="mt-2 space-y-1">
                        <p class="text-xs text-gray-500">Máximo: 7.980 jogos (TODAS as 120 combinações de 3 dígitos)</p>
                        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mt-3">
                            <h4 class="text-sm font-semibold text-blue-800 dark:text-blue-300 mb-2">📊 Distribuição das 120 Combinações de 3 Dígitos (Volumes Reais):</h4>
                            <div class="grid grid-cols-1 gap-1 text-xs">
                                <div class="text-center font-bold text-purple-600">C(10,3) = 120 combinações únicas</div>
                                <div class="text-center">• 1 combinação premium × 2.750 = 2.750 jogos</div>
                                <div class="text-center">• 6 combinações alta × 820 = 4.920 jogos</div>
                                <div class="text-center">• 1 combinação média × 190 = 190 jogos</div>
                                <div class="text-center">• 7 combinações baixa × 16 = 112 jogos</div>
                                <div class="text-center">• 105 combinações insuficientes × 0 = 8 jogos</div>
                                <div class="text-center text-green-600">• Estratégia escalável: Volume otimizado para Mega Sena</div>
                            </div>
                            <div class="text-xs font-bold text-blue-800 dark:text-blue-300 mt-2 border-t pt-2">
                                Total: 7.980 jogos únicos possíveis (3 dígitos Mega Sena)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dezenas Fixas -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Dezenas Fixas (opcional)
                    </label>
                    <div class="grid grid-cols-6 gap-2 mb-3">
                        <div id="fixed-numbers" class="col-span-6 grid grid-cols-10 gap-1">
                            <!-- Números de 1 a 60 serão gerados aqui -->
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">Selecione até 3 dezenas fixas para jogos de 3 dígitos</p>
                </div>

                <!-- Quantidade de Números -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Quantidade de números por jogo
                    </label>
                    <select id="numbers-count" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-mega-green focus:border-transparent dark:bg-gray-700 dark:text-white">
                        <option value="6">6 números - R$ 5,00 (1 aposta) ⭐ Recomendado para 3 dígitos</option>
                        <option value="7">7 números - R$ 35,00 (7 apostas)</option>
                        <option value="8">8 números - R$ 140,00 (28 apostas)</option>
                        <option value="9">9 números - R$ 420,00 (84 apostas)</option>
                        <option value="10">10 números - R$ 1.050,00 (210 apostas)</option>
                        <option value="custom">Valor personalizado</option>
                    </select>
                    
                    <!-- Campo de valor personalizado -->
                    <div id="custom-value-container" class="hidden mt-3">
                        <label class="block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">
                            Valor por jogo (R$)
                        </label>
                        <input type="number" id="custom-value" min="5.00" max="50000" step="0.01" value="5.00"
                               class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-mega-green focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </div>
                    
                    <p class="text-xs text-gray-500 mt-1">Valor total: <span id="total-value">R$ 39.900,00</span></p>
                    
                    <!-- Info sobre 3 dígitos -->
                    <div class="mt-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3">
                        <p class="text-xs text-green-700 dark:text-green-300">
                            <i class="fas fa-star text-yellow-500 mr-1"></i>
                            <strong>3 dígitos</strong> oferecem estratégia robusta para Mega Sena.
                            Cobertura ampla com 120 combinações distribuídas em 7.980 jogos!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Coluna 2 -->
            <div class="space-y-6">
                <!-- Critérios -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Critérios de Filtragem (3 Dígitos)
                        </label>
                        <button onclick="showStrategyModal()" class="text-mega-green hover:text-mega-dark-green text-sm underline">
                            <i class="fas fa-info-circle mr-1"></i>
                            Como funciona?
                        </button>
                    </div>
                    <div class="grid grid-cols-1 gap-2 max-h-64 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                        <!-- Grupo: Frequência de Números -->
                        <div class="border-b border-gray-100 dark:border-gray-700 pb-2 mb-2">
                            <h4 class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">FREQUÊNCIA DE NÚMEROS</h4>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-frequent" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Priorizar dezenas mais sorteadas</span>
                                <span id="criteria-frequent-info" class="hidden ml-2 text-xs font-semibold text-green-600">(10.0% de redução)</span>
                            </label>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-less-frequent" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Evitar dezenas menos sorteadas</span>
                                <span id="criteria-less-frequent-info" class="hidden ml-2 text-xs font-semibold text-green-600">(15.0% de redução)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="criteria-avoid-last" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Evitar dezenas do último sorteio</span>
                                <span id="criteria-avoid-last-info" class="hidden ml-2 text-xs font-semibold text-green-600">(8.0% de redução)</span>
                            </label>
                        </div>

                        <!-- Grupo: Equilíbrio -->
                        <div class="border-b border-gray-100 dark:border-gray-700 pb-2 mb-2">
                            <h4 class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">EQUILÍBRIO</h4>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-balance" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Equilíbrio entre pares e ímpares</span>
                                <span id="criteria-balance-info" class="hidden ml-2 text-xs font-semibold text-green-600">(12.0% de redução)</span>
                            </label>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-avoid-extremes" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Evitar extremos (todos pares/ímpares)</span>
                                <span id="criteria-avoid-extremes-info" class="hidden ml-2 text-xs font-semibold text-green-600">(8.0% de redução)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="criteria-clusters" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Distribuir por grupos (1-20, 21-40, 41-60)</span>
                                <span id="criteria-clusters-info" class="hidden ml-2 text-xs font-semibold text-green-600">(20.0% de redução)</span>
                            </label>
                        </div>

                        <!-- Grupo: Padrões -->
                        <div class="border-b border-gray-100 dark:border-gray-700 pb-2 mb-2">
                            <h4 class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">PADRÕES</h4>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-no-sequence" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Evitar sequências (1-2-3)</span>
                                <span id="criteria-no-sequence-info" class="hidden ml-2 text-xs font-semibold text-green-600">(25.0% de redução)</span>
                            </label>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-sum-range" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Somas dentro de faixa (60-150)</span>
                                <span id="criteria-sum-range-info" class="hidden ml-2 text-xs font-semibold text-green-600">(30.0% de redução)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="criteria-repeated-pairs" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Evitar pares repetidos do último sorteio</span>
                                <span id="criteria-repeated-pairs-info" class="hidden ml-2 text-xs font-semibold text-green-600">(5.0% de redução)</span>
                            </label>
                        </div>

                        <!-- Grupo: Avançado -->
                        <div class="border-b border-gray-100 dark:border-gray-700 pb-2 mb-2">
                            <h4 class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">AVANÇADO</h4>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-mathematical" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Fechamento matemático</span>
                                <span id="criteria-mathematical-info" class="hidden ml-2 text-xs font-semibold text-green-600">(40.0% de redução)</span>
                            </label>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-fibonacci" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Evitar sequência Fibonacci</span>
                                <span id="criteria-fibonacci-info" class="hidden ml-2 text-xs font-semibold text-green-600">(10.0% de redução)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="criteria-prime-numbers" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Balancear números primos</span>
                                <span id="criteria-prime-numbers-info" class="hidden ml-2 text-xs font-semibold text-green-600">(8.0% de redução)</span>
                            </label>
                        </div>

                        <!-- Grupo: Dígitos Mais Utilizados -->
                        <div>
                            <h4 class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2">DÍGITOS MAIS UTILIZADOS</h4>
                            <label class="flex items-center mb-1">
                                <input type="checkbox" id="criteria-most-used-digits" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Disponibilizar o conjunto de dígitos mais utilizados</span>
                                <span id="criteria-most-used-digits-info" class="hidden ml-2 text-xs font-semibold text-green-600">(70.0% de redução)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="criteria-least-used-digits" class="w-3 h-3 text-mega-green bg-gray-100 border-gray-300 rounded focus:ring-mega-green">
                                <span class="ml-2 text-xs text-gray-700 dark:text-gray-300">Disponibilizar o conjunto de dígitos menos utilizados</span>
                                <span id="criteria-least-used-digits-info" class="hidden ml-2 text-xs font-semibold text-green-600">(35.0% de redução)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculadora Dinâmica de Jogos -->
        <div class="mt-6 bg-gradient-to-r from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 border-2 border-blue-200 dark:border-blue-700 rounded-xl p-6">
            <h3 class="text-lg font-bold text-center text-blue-800 dark:text-blue-300 mb-4">
                🎯 Calculadora Inteligente de Jogos - TODAS as Combinações (3 Dígitos)
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg border border-blue-200 dark:border-blue-700">
                    <div class="text-sm text-gray-600 dark:text-gray-400">Total Máximo</div>
                    <div class="text-2xl font-bold text-blue-600">7.980</div>
                    <div class="text-xs text-gray-500">120 combinações completas</div>
                </div>
                
                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg border border-green-200 dark:border-green-700">
                    <div class="text-sm text-gray-600 dark:text-gray-400">Jogos Estimados</div>
                    <div id="estimated-games" class="text-2xl font-bold text-green-600">7.980</div>
                    <div class="text-xs text-gray-500">baseado nos filtros</div>
                </div>
                
                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg border border-orange-200 dark:border-orange-700">
                    <div class="text-sm text-gray-600 dark:text-gray-400">Redução</div>
                    <div id="reduction-percentage" class="text-2xl font-bold text-orange-600">0%</div>
                    <div class="text-xs text-gray-500">economia inteligente</div>
                </div>
            </div>
            
            <!-- Barra de Progresso da Redução -->
            <div class="mb-4">
                <div class="flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1">
                    <span>Redução de Jogos</span>
                    <span id="reduction-info">0 jogos eliminados</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4">
                    <div id="reduction-bar" class="bg-gradient-to-r from-green-500 to-orange-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Critérios Ativos -->
            <div id="active-criteria" class="mb-4 hidden">
                <div class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Critérios Ativos:</div>
                <div id="active-criteria-list" class="flex flex-wrap gap-2"></div>
            </div>
            
            <!-- Valor Total Estimado -->
            <div class="text-center p-3 bg-gradient-to-r from-mega-green to-mega-light-green rounded-lg text-white">
                <div class="text-sm opacity-90">Investimento Estimado</div>
                <div id="estimated-investment" class="text-xl font-bold">R$ 39.900,00</div>
            </div>
        </div>

        <!-- Botão Gerar -->
        <div class="mt-8 text-center">
            <button id="generate-btn" class="bg-gradient-to-r from-mega-green to-mega-light-green text-white px-8 py-4 rounded-lg font-semibold text-lg hover:from-mega-dark-green hover:to-mega-green transition-all duration-300 shadow-lg hover:shadow-xl">
                <i class="fas fa-magic mr-2"></i>
                Gerar 7.980 Jogos
            </button>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">Confira <a href="https://geradoresdiadesorte.netlify.app/diadesorteconferidor/" target="_blank" class="text-mega-green hover:underline">aqui</a> os melhores palpites</p>
        </div>
    </div>

    <!-- Resultados -->
    <div id="results-section" class="hidden">
        <!-- Estatísticas e Busca -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 mb-6">
            <div class="flex flex-col lg:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-6">
                    <div class="text-center">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Total de Jogos</p>
                        <p id="total-games" class="text-2xl font-bold text-mega-green">0</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Investimento</p>
                        <p id="total-investment" class="text-2xl font-bold text-green-600">R$ 0,00</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-600 dark:text-gray-400">Apostas Totais</p>
                        <p id="total-bets" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                </div>
                
                <!-- Busca -->
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Digite números (ex: 11 17 20)..." 
                               class="pl-10 pr-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-mega-green focus:border-transparent dark:bg-gray-700 dark:text-white">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        <div class="absolute -bottom-6 left-0 text-xs text-gray-500 dark:text-gray-400">
                            💡 Digite múltiplos números separados por espaço
                        </div>
                    </div>
                    <!-- Botões de Export -->
                    <div class="flex space-x-2">
                        <button onclick="exportToTXT()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center">
                            <i class="fas fa-file-alt mr-2"></i>
                            TXT
                        </button>
                        <button onclick="exportToXLS()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                            <i class="fas fa-file-excel mr-2"></i>
                            XLS
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Jogos -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6">
            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-6 flex items-center">
                <i class="fas fa-list text-mega-green mr-3"></i>
                Seus Jogos Gerados
            </h3>
            
            <div id="games-container" class="space-y-4">
                <!-- Jogos serão inseridos aqui -->
            </div>

            <!-- Paginação -->
            <div id="pagination" class="flex justify-center items-center mt-8 space-x-2">
                <!-- Controles de paginação -->
            </div>
        </div>
    </div>

    <!-- Modal de Estratégias -->
    <div id="strategy-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center">
                        <i class="fas fa-brain text-mega-green mr-3"></i>
                        Como Funcionam as Estratégias (3 Dígitos)
                    </h2>
                    <button onclick="hideStrategyModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Coluna 1 -->
                    <div class="space-y-4">
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h3 class="font-semibold text-mega-green mb-2">📊 Frequência de Números</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Mais sorteadas:</strong> Prioriza números que saíram mais vezes no histórico.
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Menos sorteadas:</strong> Evita números que saíram poucas vezes.
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">
                                <strong>Evitar último sorteio:</strong> Não repete números do concurso anterior.
                            </p>
                        </div>

                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h3 class="font-semibold text-mega-green mb-2">⚖️ Equilíbrio</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Pares/Ímpares:</strong> Mantém proporção equilibrada (ex: 3 pares, 3 ímpares para 6 números).
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Evitar extremos:</strong> Não gera jogos com todos pares ou todos ímpares.
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">
                                <strong>Grupos:</strong> Distribui números entre faixas (1-20, 21-40, 41-60).
                            </p>
                        </div>

                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h3 class="font-semibold text-mega-green mb-2">🔢 Apostas Múltiplas</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                Ao escolher mais de 6 números, você faz múltiplas apostas automaticamente:
                            </p>
                            <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
                                <li>• 6 números = 1 aposta de 6 números</li>
                                <li>• 7 números = 7 apostas de 6 números</li>
                                <li>• 8 números = 28 apostas de 6 números</li>
                                <li>• 9 números = 84 apostas de 6 números</li>
                                <li>• 10 números = 210 apostas de 6 números</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Coluna 2 -->
                    <div class="space-y-4">
                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h3 class="font-semibold text-mega-green mb-2">🎯 Padrões</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Sequências:</strong> Evita números consecutivos como 1-2-3.
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Soma:</strong> Mantém a soma total entre 60-150 (faixa estatística ideal para 3 dígitos).
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">
                                <strong>Pares repetidos:</strong> Evita duplas que saíram no último sorteio.
                            </p>
                        </div>

                        <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <h3 class="font-semibold text-mega-green mb-2">🧮 Avançado</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Fechamento:</strong> Garante premiação mínima com menos jogos.
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">
                                <strong>Fibonacci:</strong> Evita sequência matemática 1-1-2-3-5-8-13.
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">
                                <strong>Números primos:</strong> Balanceia quantidade de primos no jogo.
                            </p>
                        </div>

                        <div class="bg-mega-cream dark:bg-gray-900 p-4 rounded-lg border border-mega-green">
                            <h3 class="font-semibold text-mega-green mb-2">💡 TODAS as Combinações (3 Dígitos)</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300">
                                Agora você tem acesso a TODAS as 7.980 combinações possíveis, 
                                distribuídas pelos volumes reais identificados em sua análise de 3 dígitos. 
                                Use os critérios para filtrar conforme sua estratégia para a Mega Sena.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="mt-6 text-center">
                    <button onclick="hideStrategyModal()" class="bg-mega-green text-white px-6 py-2 rounded-lg hover:bg-mega-dark-green transition-colors">
                        Entendi, vamos gerar!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-mega-green mx-auto mb-4"></div>
            <p class="text-gray-700 dark:text-gray-300">Gerando seus jogos...</p>
            <p id="loading-progress" class="text-sm text-gray-500 mt-2"></p>
        </div>
    </div>
</div>

<script>
    // Configuração do tema
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (event.matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    });

    // Variáveis globais
    let allGames = [];
    let filteredGames = [];
    let currentPage = 1;
    const gamesPerPage = 20;
    let historicalData = [];
    let frequencyData = {};

    // ===== TODAS as combinações de 3 dígitos com seus volumes reais para Mega Sena =====
    const ALL_3_DIGIT_COMBINATIONS = {
        // 1 combinação premium com 2.750 jogos
        premium_volume: {
            volume: 2750,
            combinations: [
                [1,2,3]
            ]
        },
        // 6 combinações alta com 820 jogos cada
        high_volume: {
            volume: 820,
            combinations: [
                [1,2,4], [1,2,5], [1,2,6], [1,2,7], [1,2,8], [1,2,9]
            ]
        },
        // 1 combinação média com 190 jogos
        medium_volume: {
            volume: 190,
            combinations: [
                [0,1,2]
            ]
        },
        // 7 combinações baixa com 16 jogos cada
        low_volume: {
            volume: 16,
            combinations: [
                [0,1,3], [1,3,4], [1,3,5], [1,3,6], [1,3,7], [1,3,8], [1,3,9]
            ]
        },
        // 105 combinações insuficientes com 0-8 jogos cada
        insufficient: {
            volume: 8,
            combinations: [
                [0,1,4], [0,1,5], [0,1,6], [0,1,7], [0,1,8], [0,1,9], [0,2,3], [0,2,4], [0,2,5],
                [0,2,6], [0,2,7], [0,2,8], [0,2,9], [0,3,4], [0,3,5], [0,3,6], [0,3,7], [0,3,8],
                [0,3,9], [0,4,5], [0,4,6], [0,4,7], [0,4,8], [0,4,9], [0,5,6], [0,5,7], [0,5,8],
                [0,5,9], [0,6,7], [0,6,8], [0,6,9], [0,7,8], [0,7,9], [0,8,9], [1,4,5], [1,4,6],
                [1,4,7], [1,4,8], [1,4,9], [1,5,6], [1,5,7], [1,5,8], [1,5,9], [1,6,7], [1,6,8],
                [1,6,9], [1,7,8], [1,7,9], [1,8,9], [2,3,4], [2,3,5], [2,3,6], [2,3,7], [2,3,8],
                [2,3,9], [2,4,5], [2,4,6], [2,4,7], [2,4,8], [2,4,9], [2,5,6], [2,5,7], [2,5,8],
                [2,5,9], [2,6,7], [2,6,8], [2,6,9], [2,7,8], [2,7,9], [2,8,9], [3,4,5], [3,4,6],
                [3,4,7], [3,4,8], [3,4,9], [3,5,6], [3,5,7], [3,5,8], [3,5,9], [3,6,7], [3,6,8],
                [3,6,9], [3,7,8], [3,7,9], [3,8,9], [4,5,6], [4,5,7], [4,5,8], [4,5,9], [4,6,7],
                [4,6,8], [4,6,9], [4,7,8], [4,7,9], [4,8,9], [5,6,7], [5,6,8], [5,6,9], [5,7,8],
                [5,7,9], [5,8,9], [6,7,8], [6,7,9], [6,8,9], [7,8,9]
            ]
        }
    };

    // Total máximo de jogos = 7.980
    const MAX_TOTAL_GAMES = 7980;

    // APIs REAIS da Caixa para MEGA SENA
    const API_CONFIG = {
        MEGA_SENA_STATIC: {
            url: "https://servicebus2.caixa.gov.br/portaldeloterias/api/megasena",
            description: "API Oficial da Caixa"
        },
        MEGA_SENA_CONCURSO: (numero) => {
            return {
                url: `https://servicebus2.caixa.gov.br/portaldeloterias/api/megasena/${numero}`,
                description: `API Oficial Caixa - Concurso ${numero}`
            };
        },
        PROXIES: [
            '',  // First try direct
            'https://corsproxy.io/?',
            'https://api.allorigins.win/raw?url=',
            'https://cors-anywhere.herokuapp.com/',
            'https://api.codetabs.com/v1/proxy?quest='
        ]
    };

    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        initializeApp();
    });

    async function initializeApp() {
        createFixedNumbersGrid();
        setupEventListeners();
        
        // ===== DESABILITAR TUDO ATÉ DADOS ESTAREM CARREGADOS =====
        disableAllControls();
        
        await loadHistoricalData();
        updateTotalValue();
    }
    
    function disableAllControls() {
        console.log('🔒 DESABILITANDO TODOS OS CONTROLES - Aguardando carregamento COMPLETO dos dados históricos...');
        
        // ===== VERIFICAÇÃO CRÍTICA: DADOS HISTÓRICOS DEVEM ESTAR VAZIOS =====
        if (historicalData && historicalData.length > 0) {
            console.error('❌ ERRO CRÍTICO: disableAllControls() chamado mas dados históricos já existem!');
            return; // Não desabilitar se dados já foram carregados
        }
        
        // ===== DESABILITAR BOTÃO DE GERAR JOGOS =====
        const generateBtn = document.getElementById('generate-btn');
        generateBtn.disabled = true;
        generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
        generateBtn.innerHTML = '<i class="fas fa-lock mr-2"></i>⏳ Aguarde carregamento COMPLETO dos dados reais da API...';
        
        // ===== DESABILITAR TODOS OS CRITÉRIOS =====
        document.querySelectorAll('input[type="checkbox"][id^="criteria-"]').forEach(checkbox => {
            checkbox.disabled = true;
            checkbox.parentElement.classList.add('opacity-50', 'cursor-not-allowed');
            // IMPORTANTE: Remover event listeners para prevenir cálculos prematuros
            checkbox.removeEventListener('change', calculateEstimatedGames);
        });
        
        // ===== DESABILITAR CALCULADORA INTELIGENTE =====
        const calculatorSection = document.querySelector('.bg-gradient-to-r.from-blue-50');
        if (calculatorSection) {
            calculatorSection.classList.add('opacity-50', 'cursor-not-allowed');
            calculatorSection.style.pointerEvents = 'none'; // Prevenir qualquer interação
        }
        
        // ===== DESABILITAR CAMPOS DE ENTRADA =====
        document.getElementById('num-games').disabled = true;
        document.getElementById('numbers-count').disabled = true;
        document.getElementById('custom-value').disabled = true;
        
        // ===== DESABILITAR DEZENAS FIXAS =====
        document.querySelectorAll('#fixed-numbers button').forEach(button => {
            button.disabled = true;
            button.classList.add('opacity-50', 'cursor-not-allowed');
            button.onclick = null; // Remover evento temporariamente
            button.style.pointerEvents = 'none'; // Prevenir cliques
        });
        
        // ===== BLOQUEAR CÁLCULOS DA CALCULADORA INTELIGENTE =====
        const estimatedGamesElement = document.getElementById('estimated-games');
        if (estimatedGamesElement) {
            estimatedGamesElement.textContent = '⏳ Aguardando dados...';
            estimatedGamesElement.style.color = '#888';
        }
        
        const reductionElement = document.getElementById('reduction-percentage');
        if (reductionElement) {
            reductionElement.textContent = '⏳';
            reductionElement.style.color = '#888';
        }
        
        console.log('✅ TODOS OS CONTROLES DESABILITADOS - Sistema aguardando carregamento COMPLETO dos dados históricos');
    }

    function createFixedNumbersGrid() {
        const container = document.getElementById('fixed-numbers');
        for (let i = 1; i <= 60; i++) {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'w-8 h-8 text-xs border border-gray-300 dark:border-gray-600 rounded hover:bg-mega-green hover:text-white transition-all duration-200 dark:text-white';
            button.textContent = i.toString().padStart(2, '0');
            button.dataset.number = i;
            button.onclick = toggleFixedNumber;
            container.appendChild(button);
        }
    }

    function toggleFixedNumber(event) {
        const button = event.target;
        const selectedButtons = document.querySelectorAll('#fixed-numbers button.bg-mega-green');
        
        if (button.classList.contains('bg-mega-green')) {
            button.classList.remove('bg-mega-green', 'text-white');
            button.classList.add('hover:bg-mega-green', 'hover:text-white');
        } else if (selectedButtons.length < 3) { // Para 3 dígitos, máximo 3 fixas
            button.classList.add('bg-mega-green', 'text-white');
            button.classList.remove('hover:bg-mega-green', 'hover:text-white');
        } else {
            showAlert('Você pode selecionar no máximo 3 dezenas fixas para jogos de 3 dígitos.');
        }
    }

    function setupEventListeners() {
        document.getElementById('num-games').addEventListener('input', updateTotalValue);
        document.getElementById('numbers-count').addEventListener('change', updateTotalValue);
        document.getElementById('generate-btn').addEventListener('click', generateGames);
        document.getElementById('search-input').addEventListener('input', filterGames);
        document.getElementById('custom-value').addEventListener('input', updateTotalValue);
        
        // Event listeners para os critérios de filtragem
        document.querySelectorAll('input[type="checkbox"][id^="criteria-"]').forEach(checkbox => {
            checkbox.addEventListener('change', calculateEstimatedGames);
        });
    }

    // Função para fazer fetch com CORS proxy
    async function fetchWithProxy(url, attempts = 0) {
        const corsProxies = API_CONFIG.PROXIES;
        
        if (attempts >= corsProxies.length) {
            throw new Error('All CORS proxies failed');
        }
        
        try {
            // Some proxies need different URL encoding
            let proxyUrl;
            if (corsProxies[attempts].includes('?url=') || corsProxies[attempts].includes('?quest=')) {
                proxyUrl = corsProxies[attempts] + encodeURIComponent(url);
            } else {
                proxyUrl = corsProxies[attempts] + url;
            }
            
            console.log(`Tentando proxy ${attempts + 1}/${corsProxies.length}: ${proxyUrl}`);
            
            const response = await fetch(proxyUrl);
            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.log(`Proxy ${attempts + 1} falhou: ${error.message}`);
            // Try next proxy
            if (attempts < corsProxies.length - 1) {
                return fetchWithProxy(url, attempts + 1);
            } else {
                throw error;
            }
        }
    }

    // Função para obter o último número de concurso
    async function getLatestContestNumber() {
        try {
            const lastConcursoData = await fetchWithProxy(API_CONFIG.MEGA_SENA_STATIC.url);
            if (lastConcursoData && lastConcursoData.numero) {
                return parseInt(lastConcursoData.numero);
            }
            throw new Error("Could not get the latest contest number");
        } catch (error) {
            console.log(`Erro ao obter último concurso: ${error.message}`);
            return 2897; // Valor aproximado atual da Mega Sena
        }
    }

    // ===== FUNÇÃO PRINCIPAL: CARREGAR TODOS OS SORTEIOS REAIS (DO 1 ATÉ O ÚLTIMO) =====
    async function loadHistoricalData() {
        updateLoadingStatus('Verificando último concurso disponível...', 5);
        document.getElementById('api-status').textContent = '🔄';
        
        // Desabilitar botão de gerar jogos
        document.getElementById('generate-btn').disabled = true;
        document.getElementById('generate-btn').classList.add('opacity-50', 'cursor-not-allowed');
        document.getElementById('generate-btn').innerHTML = '<i class="fas fa-lock mr-2"></i>Aguarde carregamento dos dados reais da API da Caixa...';
        
        try {
            // 1. Obter o último número de concurso
            updateLoadingStatus('Obtendo último concurso da API da Caixa...', 10);
            const lastContestNumber = await getLatestContestNumber();
            
            console.log(`📊 Último concurso identificado: ${lastContestNumber}`);
            updateLoadingStatus(`Último concurso: ${lastContestNumber}. Carregando do concurso 1 até ${lastContestNumber}...`, 15);
            
            // 2. Carregar todos os concursos do 1 até o último
            historicalData = [];
            const totalConcursos = lastContestNumber;
            const batchSize = 50; // Carregar em lotes de 50
            
            for (let start = 1; start <= totalConcursos; start += batchSize) {
                const end = Math.min(start + batchSize - 1, totalConcursos);
                const currentProgress = 15 + (start / totalConcursos) * 80; // 15% a 95%
                
                updateLoadingStatus(`Carregando concursos ${start} a ${end} de ${totalConcursos}...`, currentProgress);
                document.getElementById('loaded-count').textContent = historicalData.length;
                
                // Carregar lote atual
                const batchPromises = [];
                for (let i = start; i <= end; i++) {
                    batchPromises.push(loadSingleContest(i));
                }
                
                // Aguardar todos os concursos do lote
                const batchResults = await Promise.allSettled(batchPromises);
                
                // Processar resultados do lote
                batchResults.forEach((result, index) => {
                    if (result.status === 'fulfilled' && result.value) {
                        historicalData.push(result.value);
                    } else {
                        console.log(`⚠️ Concurso ${start + index} não encontrado ou erro: ${result.reason || 'Sem dados'}`);
                    }
                });
                
                // Pequena pausa para não sobrecarregar a API
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // 3. Ordenar por número do concurso (mais recente primeiro)
            historicalData.sort((a, b) => parseInt(b.numero) - parseInt(a.numero));
            
            // 4. Finalizar carregamento
            updateLoadingStatus(`✅ DADOS REAIS CARREGADOS! ${historicalData.length} de ${totalConcursos} concursos da API da Caixa`, 100);
            document.getElementById('api-status').textContent = '✅';
            document.getElementById('loaded-count').textContent = historicalData.length;
            document.getElementById('cache-status').textContent = '✅';
            
            // Processar os resultados
            calculateFrequency();
            updateLastDraw();
            showDataSummary();
            
            enableGameGeneration();
            
            return true;
            
        } catch (error) {
            console.error("Erro no carregamento:", error);
            document.getElementById('api-status').textContent = '❌';
            updateLoadingStatus(`❌ Erro: ${error.message}`, 0);
            
            // Mostrar botão de retry
            document.getElementById('retry-loading').classList.remove('hidden');
            document.getElementById('retry-loading').onclick = () => {
                document.getElementById('retry-loading').classList.add('hidden');
                loadHistoricalData();
            };
            
            return false;
        }
    }

    // Função para carregar um único concurso
    async function loadSingleContest(contestNumber) {
        try {
            const contestData = await fetchWithProxy(API_CONFIG.MEGA_SENA_CONCURSO(contestNumber).url);
            
            // Verificar se os dados são válidos
            if (contestData && contestData.numero && contestData.listaDezenas && contestData.listaDezenas.length === 6) {
                return {
                    numero: parseInt(contestData.numero),
                    dataApuracao: contestData.dataApuracao || '',
                    listaDezenas: contestData.listaDezenas || []
                };
            }
            
            return null;
        } catch (error) {
            // Concurso não existe ou erro na API
            return null;
        }
    }

    function updateLoadingStatus(message, progress) {
        document.getElementById('loading-status').textContent = message;
        document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    function enableGameGeneration() {
        // ===== VERIFICAR SE DADOS REALMENTE FORAM CARREGADOS =====
        if (!historicalData || historicalData.length === 0) {
            console.error('❌ ERRO: Tentativa de habilitar controles sem dados históricos válidos');
            return false;
        }
        
        // ===== HABILITAR BOTÃO DE GERAR JOGOS =====
        document.getElementById('generate-btn').disabled = false;
        document.getElementById('generate-btn').classList.remove('opacity-50', 'cursor-not-allowed');
        document.getElementById('generate-btn').innerHTML = '<i class="fas fa-magic mr-2"></i>Gerar Jogos';
        
        // ===== HABILITAR TODOS OS CRITÉRIOS =====
        document.querySelectorAll('input[type="checkbox"][id^="criteria-"]').forEach(checkbox => {
            checkbox.disabled = false;
            checkbox.parentElement.classList.remove('opacity-50', 'cursor-not-allowed');
        });
        
        // ===== RE-ADICIONAR EVENT LISTENERS PARA CALCULADORA INTELIGENTE =====
        console.log('🔄 REATIVANDO Calculadora Inteligente...');
        document.querySelectorAll('input[type="checkbox"][id^="criteria-"]').forEach(checkbox => {
            // Remover listeners antigos para evitar duplicação
            checkbox.removeEventListener('change', calculateEstimatedGames);
            // Adicionar listener novo
            checkbox.addEventListener('change', calculateEstimatedGames);
        });
        
        // ===== HABILITAR CALCULADORA INTELIGENTE =====
        const calculatorSection = document.querySelector('.bg-gradient-to-r.from-blue-50');
        if (calculatorSection) {
            calculatorSection.classList.remove('opacity-50', 'cursor-not-allowed');
            calculatorSection.style.pointerEvents = 'auto'; // Reativar interações
        }
        
        // ===== HABILITAR CAMPOS DE ENTRADA =====
        document.getElementById('num-games').disabled = false;
        document.getElementById('numbers-count').disabled = false;
        document.getElementById('custom-value').disabled = false;
        
        // ===== HABILITAR DEZENAS FIXAS =====
        document.querySelectorAll('#fixed-numbers button').forEach(button => {
            button.disabled = false;
            button.classList.remove('opacity-50', 'cursor-not-allowed');
            button.onclick = toggleFixedNumber; // Reativar evento
            button.style.pointerEvents = 'auto'; // Reativar cliques
        });
        
        // ===== RECALCULAR ESTIMATIVAS AGORA QUE OS DADOS ESTÃO PRONTOS =====
        console.log('📊 RECALCULANDO estimativas com dados reais...');
        calculateEstimatedGames();
        updateTotalValue();
        
        console.log('✅ SISTEMA TOTALMENTE HABILITADO - Dados históricos carregados com sucesso!');
        console.log('✅ Calculadora Inteligente REATIVADA com event listeners funcionais!');
        
        return true;
    }

    function updateTotalValue() {
        const numGames = parseInt(document.getElementById('num-games').value) || 0;
        const numbersCount = document.getElementById('numbers-count').value;
        
        let price = 5.00; // Preço padrão para 6 números (recomendado para 3 dígitos)
        
        if (numbersCount === 'custom') {
            // Mostrar campo personalizado
            document.getElementById('custom-value-container').classList.remove('hidden');
            price = parseFloat(document.getElementById('custom-value').value) || 5.00;
        } else {
            // Ocultar campo personalizado
            document.getElementById('custom-value-container').classList.add('hidden');
            
            // Tabela de preços e apostas para Mega Sena
            const gameData = {
                6: { price: 5.00, bets: 1 },
                7: { price: 35.00, bets: 7 },
                8: { price: 140.00, bets: 28 },
                9: { price: 420.00, bets: 84 },
                10: { price: 1050.00, bets: 210 }
            };
            
            const data = gameData[parseInt(numbersCount)] || gameData[6];
            price = data.price;
        }
        
        const total = numGames * price;
        document.getElementById('total-value').textContent = `R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        
        // Atualizar estimativa de jogos
        calculateEstimatedGames();
    }

    // ===== SISTEMA DINÂMICO DE REDUÇÃO EM TEMPO REAL =====
    function calculateEstimatedGames() {
        const baseGames = MAX_TOTAL_GAMES; // Base: TODAS as combinações
        let reductionFactor = 1.0;
        const activeCriteria = [];
        
        // Definir fatores de redução para cada critério (ajustados para 3 dígitos)
        const reductionFactors = {
            'criteria-frequent': { factor: 0.90, name: 'Mais Sorteadas', reduction: '10.0%' },
            'criteria-less-frequent': { factor: 0.85, name: 'Evitar Menos Frequentes', reduction: '15.0%' },
            'criteria-avoid-last': { factor: 0.92, name: 'Evitar Último Sorteio', reduction: '8.0%' },
            'criteria-balance': { factor: 0.88, name: 'Equilibrio Par/Ímpar', reduction: '12.0%' },
            'criteria-avoid-extremes': { factor: 0.92, name: 'Evitar Extremos', reduction: '8.0%' },
            'criteria-clusters': { factor: 0.80, name: 'Distribuir Grupos', reduction: '20.0%' },
            'criteria-no-sequence': { factor: 0.75, name: 'Evitar Sequências', reduction: '25.0%' },
            'criteria-sum-range': { factor: 0.70, name: 'Faixa de Soma', reduction: '30.0%' },
            'criteria-repeated-pairs': { factor: 0.95, name: 'Evitar Pares Repetidos', reduction: '5.0%' },
            'criteria-mathematical': { factor: 0.60, name: 'Fechamento Matemático', reduction: '40.0%' },
            'criteria-fibonacci': { factor: 0.90, name: 'Evitar Fibonacci', reduction: '10.0%' },
            'criteria-prime-numbers': { factor: 0.92, name: 'Balancear Primos', reduction: '8.0%' },
            'criteria-most-used-digits': { factor: 0.30, name: 'Dígitos Mais Usados', reduction: '70.0%' },
            'criteria-least-used-digits': { factor: 0.65, name: 'Dígitos Menos Usados', reduction: '35.0%' }
        };
        
        // Atualizar informações inline para cada critério
        Object.keys(reductionFactors).forEach(criteriaId => {
            const checkbox = document.getElementById(criteriaId);
            const infoSpan = document.getElementById(criteriaId + '-info');
            
            if (checkbox && infoSpan) {
                if (checkbox.checked) {
                    // Mostrar informação específica do critério
                    const criteria = reductionFactors[criteriaId];
                    infoSpan.textContent = `(${criteria.reduction} de redução)`;
                    infoSpan.classList.remove('hidden');
                    
                    // Aplicar fator de redução
                    reductionFactor *= criteria.factor;
                    activeCriteria.push(criteria);
                } else {
                    // Ocultar informação
                    infoSpan.classList.add('hidden');
                }
            }
        });
        
        // Calcular jogos estimados
        const estimatedGames = Math.round(baseGames * reductionFactor);
        const totalReduction = baseGames - estimatedGames;
        const reductionPercentage = ((totalReduction / baseGames) * 100).toFixed(1);
        
        // Calcular investimento estimado
        const numbersCount = document.getElementById('numbers-count').value;
        let price = 5.00;
        if (numbersCount === 'custom') {
            price = parseFloat(document.getElementById('custom-value').value) || 5.00;
        } else {
            const gameData = {
                6: 5.00, 7: 35.00, 8: 140.00, 9: 420.00, 10: 1050.00
            };
            price = gameData[parseInt(numbersCount)] || 5.00;
        }
        const estimatedInvestment = estimatedGames * price;
        
        // Atualizar interface
        updateDynamicCalculator(estimatedGames, reductionPercentage, totalReduction, estimatedInvestment, activeCriteria);
        updateGenerateButton(`Gerar ${estimatedGames.toLocaleString()} Jogos${reductionPercentage > 0 ? ` (-${reductionPercentage}%)` : ''}`);
    }
    
    function updateDynamicCalculator(estimatedGames, reductionPercentage, totalReduction, estimatedInvestment, activeCriteria) {
        // Atualizar números principais
        document.getElementById('estimated-games').textContent = estimatedGames.toLocaleString();
        document.getElementById('reduction-percentage').textContent = `${reductionPercentage}%`;
        document.getElementById('reduction-info').textContent = `${totalReduction.toLocaleString()} jogos eliminados`;
        document.getElementById('estimated-investment').textContent = `R$ ${estimatedInvestment.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        
        // Atualizar barra de progresso
        document.getElementById('reduction-bar').style.width = `${Math.min(parseFloat(reductionPercentage), 100)}%`;
        
        // Mostrar/ocultar critérios ativos
        const activeCriteriaSection = document.getElementById('active-criteria');
        const activeCriteriaList = document.getElementById('active-criteria-list');
        
        if (activeCriteria.length > 0) {
            activeCriteriaSection.classList.remove('hidden');
            activeCriteriaList.innerHTML = activeCriteria.map(criteria => 
                `<span class="px-2 py-1 bg-mega-green text-white text-xs rounded-full">
                    ${criteria.name} ${criteria.reduction}
                </span>`
            ).join('');
        } else {
            activeCriteriaSection.classList.add('hidden');
        }
    }

    function updateGenerateButton(text) {
        const button = document.getElementById('generate-btn');
        button.innerHTML = `<i class="fas fa-magic mr-2"></i>${text}`;
    }

    function showDataSummary() {
        document.getElementById('data-summary').classList.remove('hidden');
        
        if (historicalData.length > 0) {
            const first = historicalData[historicalData.length - 1];
            const last = historicalData[0];
            const lastContestNumber = last.numero || historicalData.length;
            const firstContestNumber = first.numero || 1;
            
            // Calcular estatísticas de cobertura
            const totalExisting = lastContestNumber; // Total de concursos que existem (1 até o último)
            const totalLoaded = historicalData.length; // Quantos conseguimos carregar
            const coveragePercentage = Math.round((totalLoaded / totalExisting) * 100);
            const missingCount = totalExisting - totalLoaded;
            
            // Atualizar informações de cobertura
            document.getElementById('total-contests').textContent = totalLoaded.toLocaleString();
            document.getElementById('total-existing').textContent = totalExisting.toLocaleString();
            document.getElementById('coverage-percentage').textContent = `${coveragePercentage}%`;
            document.getElementById('missing-count').textContent = missingCount.toLocaleString();
            
            // Atualizar barra de progresso da cobertura
            document.getElementById('coverage-bar').style.width = `${coveragePercentage}%`;
            document.getElementById('coverage-text').textContent = `${totalLoaded.toLocaleString()} de ${totalExisting.toLocaleString()} concursos`;
            
            // Período carregado (corrigir ordem)
            document.getElementById('period-range').textContent = `${Math.min(firstContestNumber, lastContestNumber)} até ${Math.max(firstContestNumber, lastContestNumber)}`;
            
            // Encontrar número mais frequente
            let mostFreqNumber = 1;
            let maxFreq = 0;
            for (let i = 1; i <= 60; i++) {
                if (frequencyData[i] > maxFreq) {
                    maxFreq = frequencyData[i];
                    mostFreqNumber = i;
                }
            }
            document.getElementById('most-frequent').textContent = 
                `${mostFreqNumber.toString().padStart(2, '0')} (${maxFreq}x)`;
            
            document.getElementById('data-source').textContent = 'API Caixa Oficial';
        }
    }

    function calculateFrequency() {
        frequencyData = {};
        
        // Inicializar contadores
        for (let i = 1; i <= 60; i++) {
            frequencyData[i] = 0;
        }

        // Contar frequências
        historicalData.forEach(result => {
            if (result.listaDezenas) {
                result.listaDezenas.forEach(dezena => {
                    const num = parseInt(dezena);
                    if (num >= 1 && num <= 60) {
                        frequencyData[num]++;
                    }
                });
            }
        });
    }

    function updateLastDraw() {
        if (historicalData.length > 0) {
            const latest = historicalData[0];
            const element = document.getElementById('last-draw');
            if (latest) {
                element.innerHTML = `
                    <div>Concurso ${latest.numero || 'N/A'}</div>
                    <div class="text-xs">${latest.listaDezenas ? latest.listaDezenas.join(' - ') : 'N/A'}</div>
                `;
            }
        }
    }

    async function generateGames() {
        // USAR O VALOR EXATO DA CALCULADORA INTELIGENTE
        const estimatedGamesText = document.getElementById('estimated-games').textContent;
        const exactGamesToGenerate = parseInt(estimatedGamesText.replace(/\./g, '').replace(/,/g, ''));
        
        // Verificar se há critérios ativos
        const activeCriteria = document.querySelectorAll('input[type="checkbox"][id^="criteria-"]:checked');
        
        let numGames;
        if (activeCriteria.length > 0) {
            // SE HÁ CRITÉRIOS ATIVOS: usar valor EXATO da calculadora
            numGames = exactGamesToGenerate;
            console.log(`🎯 GERANDO EXATAMENTE ${numGames} jogos (valor da Calculadora Inteligente)`);
        } else {
            // SE NÃO HÁ CRITÉRIOS: usar valor do campo input
            numGames = parseInt(document.getElementById('num-games').value);
            console.log(`📝 Gerando ${numGames} jogos (valor do campo input)`);
        }
        
        if (!numGames || numGames < 10 || numGames > MAX_TOTAL_GAMES) {
            showAlert(`Número de jogos inválido. O máximo é ${MAX_TOTAL_GAMES.toLocaleString()} jogos.`);
            return;
        }

        showLoading(true);
        document.getElementById('loading-progress').textContent = 'Iniciando geração...';
        
        try {
            const config = getGameConfig();
            allGames = [];

            // Gerar jogos em lotes para não travar a interface
            const batchSize = 100; // Menor para 3 dígitos
            const batches = Math.ceil(numGames / batchSize);

            for (let batch = 0; batch < batches; batch++) {
                const batchStart = batch * batchSize;
                const batchEnd = Math.min(batchStart + batchSize, numGames);
                const batchGames = [];

                document.getElementById('loading-progress').textContent = 
                    `Gerando lote ${batch + 1} de ${batches}... (${Math.round((batch / batches) * 100)}%)`;

                for (let i = batchStart; i < batchEnd; i++) {
                    const game = generateSingleGame(config);
                    batchGames.push({
                        id: i + 1,
                        numbers: game.numbers,
                        sum: game.numbers.reduce((a, b) => a + b, 0)
                    });
                }

                allGames.push(...batchGames);

                // Pequena pausa para não travar a interface
                if (batch < batches - 1) {
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
            }

            filteredGames = [...allGames];
            currentPage = 1;
            displayResults();
            
        } catch (error) {
            console.error('Erro ao gerar jogos:', error);
            showAlert('Erro ao gerar jogos. Tente novamente.');
        } finally {
            showLoading(false);
        }
    }

    function getGameConfig() {
        const fixedNumbers = Array.from(document.querySelectorAll('#fixed-numbers button.bg-mega-green'))
            .map(btn => parseInt(btn.dataset.number));
        
        return {
            fixedNumbers,
            useFrequent: document.getElementById('criteria-frequent').checked,
            lessFrequent: document.getElementById('criteria-less-frequent').checked,
            avoidLast: document.getElementById('criteria-avoid-last').checked,
            balance: document.getElementById('criteria-balance').checked,
            avoidExtremes: document.getElementById('criteria-avoid-extremes').checked,
            clusters: document.getElementById('criteria-clusters').checked,
            noSequence: document.getElementById('criteria-no-sequence').checked,
            sumRange: document.getElementById('criteria-sum-range').checked,
            repeatedPairs: document.getElementById('criteria-repeated-pairs').checked,
            mathematical: document.getElementById('criteria-mathematical').checked,
            fibonacci: document.getElementById('criteria-fibonacci').checked,
            primeNumbers: document.getElementById('criteria-prime-numbers').checked
        };
    }

    function generateSingleGame(config) {
        let numbers = [...config.fixedNumbers];
        const targetNumbers = parseInt(document.getElementById('numbers-count').value) || 6; // Padrão 6 para Mega Sena
        let availableNumbers = [];

        // Criar pool de números disponíveis
        for (let i = 1; i <= 60; i++) {
            if (!numbers.includes(i)) {
                availableNumbers.push(i);
            }
        }

        // Aplicar critérios de filtragem
        availableNumbers = applyFilters(availableNumbers, config);

        // Completar o jogo
        while (numbers.length < targetNumbers && availableNumbers.length > 0) {
            const index = selectNumberIndex(availableNumbers, config);
            const selectedNumber = availableNumbers.splice(index, 1)[0];
            numbers.push(selectedNumber);

            // Verificar critérios dinâmicos
            if (!validateGameCriteria(numbers, config)) {
                numbers.pop();
                continue;
            }
        }

        // Completar com números aleatórios se necessário
        while (numbers.length < targetNumbers) {
            const remaining = [];
            for (let i = 1; i <= 60; i++) {
                if (!numbers.includes(i)) remaining.push(i);
            }
            if (remaining.length === 0) break;
            
            const randomIndex = Math.floor(Math.random() * remaining.length);
            numbers.push(remaining[randomIndex]);
        }

        numbers.sort((a, b) => a - b);

        return { numbers };
    }

    function applyFilters(numbers, config) {
        let filtered = [...numbers];

        // Filtro por frequência
        if (config.useFrequent) {
            filtered.sort((a, b) => (frequencyData[b] || 0) - (frequencyData[a] || 0));
            filtered = filtered.slice(0, Math.min(30, filtered.length));
        }

        if (config.lessFrequent) {
            const avgFreq = Object.values(frequencyData).reduce((a, b) => a + b, 0) / 60;
            filtered = filtered.filter(num => (frequencyData[num] || 0) >= avgFreq * 0.7);
        }

        // Evitar último sorteio
        if (config.avoidLast && historicalData.length > 0) {
            const lastNumbers = historicalData[0].listaDezenas?.map(n => parseInt(n)) || [];
            filtered = filtered.filter(num => !lastNumbers.includes(num) || Math.random() > 0.8);
        }

        return filtered;
    }

    function selectNumberIndex(numbers, config) {
        if (config.useFrequent) {
            return Math.floor(Math.random() * Math.min(15, numbers.length));
        }
        return Math.floor(Math.random() * numbers.length);
    }

    function validateGameCriteria(numbers, config) {
        // Verificar sequências (para 6 números, sequência de 3 é crítica)
        if (config.noSequence && hasSequence(numbers, 3)) {
            return false;
        }

        // Verificar equilíbrio par/ímpar
        if (config.balance || config.avoidExtremes) {
            const evens = numbers.filter(n => n % 2 === 0).length;
            const odds = numbers.length - evens;
            
            if (config.avoidExtremes && (evens === 0 || odds === 0)) {
                return false;
            }
            
            if (config.balance && numbers.length >= 6 && Math.abs(evens - odds) > 2) { // Para 6 números
                return false;
            }
        }

        // Verificar agrupamento
        if (config.clusters && numbers.length >= 6) {
            const group1 = numbers.filter(n => n <= 20).length;
            const group2 = numbers.filter(n => n > 20 && n <= 40).length;
            const group3 = numbers.filter(n => n > 40).length;
            
            // Para 6 números, permitir que um grupo fique com poucos
            const emptyGroups = [group1, group2, group3].filter(g => g === 0).length;
            if (emptyGroups > 1) {
                return false;
            }
        }

        // Verificar soma (ajustado para Mega Sena)
        if (config.sumRange) {
            const sum = numbers.reduce((a, b) => a + b, 0);
            if (sum < 60 || sum > 150) { // Faixa ajustada para Mega Sena
                return false;
            }
        }

        // Verificar Fibonacci
        if (config.fibonacci) {
            const fibonacci = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55];
            const fibCount = numbers.filter(n => fibonacci.includes(n)).length;
            if (fibCount > 3) return false; // Ajustado para 6 números
        }

        // Verificar números primos
        if (config.primeNumbers) {
            const primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59];
            const primeCount = numbers.filter(n => primes.includes(n)).length;
            const ratio = primeCount / numbers.length;
            if (ratio < 0.1 || ratio > 0.7) return false; // Ajustado para 6 números
        }

        return true;
    }

    function hasSequence(numbers, length) {
        const sorted = [...numbers].sort((a, b) => a - b);
        let sequence = 1;
        for (let i = 1; i < sorted.length; i++) {
            if (sorted[i] === sorted[i-1] + 1) {
                sequence++;
                if (sequence >= length) return true;
            } else {
                sequence = 1;
            }
        }
        return false;
    }

    function filterGames() {
        const searchTerm = document.getElementById('search-input').value.trim();
        
        if (!searchTerm) {
            filteredGames = [...allGames];
        } else {
            // Busca inteligente por múltiplos números
            const searchNumbers = [];
            
            // Extrair números da busca (separados por espaço, vírgula ou hífen)
            const cleanSearch = searchTerm.replace(/[,-]/g, ' '); // Substitui vírgulas e hífens por espaços
            const parts = cleanSearch.split(/\s+/).filter(part => part.length > 0);
            
            for (const part of parts) {
                const num = parseInt(part);
                if (!isNaN(num) && num >= 1 && num <= 60) {
                    searchNumbers.push(num);
                }
            }
            
            if (searchNumbers.length > 0) {
                // Filtrar jogos que contêm TODOS os números buscados
                filteredGames = allGames.filter(game => {
                    return searchNumbers.every(searchNum => game.numbers.includes(searchNum));
                });
            } else {
                // Se não há números válidos, buscar por outros critérios
                filteredGames = allGames.filter(game => {
                    // Busca por ID do jogo
                    if (game.id.toString().includes(searchTerm)) {
                        return true;
                    }
                    
                    return false;
                });
            }
        }
        
        currentPage = 1;
        displayGames();
        updatePagination();
    }

    function displayResults() {
        document.getElementById('results-section').classList.remove('hidden');
        document.getElementById('total-games').textContent = allGames.length.toLocaleString();
        
        const numbersCount = parseInt(document.getElementById('numbers-count').value) || 6;
        const gameData = {
            6: { price: 5.00, bets: 1 },
            7: { price: 35.00, bets: 7 },
            8: { price: 140.00, bets: 28 },
            9: { price: 420.00, bets: 84 },
            10: { price: 1050.00, bets: 210 }
        };
        
        const data = gameData[numbersCount] || gameData[6];
        const investment = allGames.length * data.price;
        const totalBets = allGames.length * data.bets;
        
        document.getElementById('total-investment').textContent = 
            `R$ ${investment.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        document.getElementById('total-bets').textContent = totalBets.toLocaleString();
        
        displayGames();
        updatePagination();
    }

    function displayGames() {
        const container = document.getElementById('games-container');
        const startIndex = (currentPage - 1) * gamesPerPage;
        const endIndex = startIndex + gamesPerPage;
        const gamesToShow = filteredGames.slice(startIndex, endIndex);
        const searchTerm = document.getElementById('search-input').value.trim();

        container.innerHTML = gamesToShow.map(game => {
            // Função para destacar números encontrados
            const highlightNumbers = (numbers) => {
                return numbers.map(num => {
                    const numStr = num.toString().padStart(2, '0');
                    let isHighlighted = false;
                    
                    if (searchTerm) {
                        // Extrair números da busca (mesmo processo do filtro)
                        const searchNumbers = [];
                        const cleanSearch = searchTerm.replace(/[,-]/g, ' ');
                        const parts = cleanSearch.split(/\s+/).filter(part => part.length > 0);
                        
                        for (const part of parts) {
                            const searchNum = parseInt(part);
                            if (!isNaN(searchNum) && searchNum >= 1 && searchNum <= 60) {
                                searchNumbers.push(searchNum);
                            }
                        }
                        
                        // Destacar se o número está na lista de números buscados
                        if (searchNumbers.includes(num)) {
                            isHighlighted = true;
                        }
                    }
                    
                    const baseClasses = "w-8 h-8 text-white rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300";
                    const backgroundClasses = isHighlighted 
                        ? "bg-gradient-to-br from-green-500 to-green-600 shadow-lg ring-2 ring-green-300 animate-pulse" 
                        : "bg-gradient-to-br from-mega-green to-mega-light-green";
                    
                    return `<span class="${baseClasses} ${backgroundClasses}">${numStr}</span>`;
                }).join('');
            };

            // Função para destacar ID do jogo
            const highlightGameId = (gameId) => {
                if (searchTerm && gameId.toString().includes(searchTerm)) {
                    return `<mark class="bg-yellow-200 dark:bg-yellow-600 px-1 rounded">Jogo #${gameId}</mark>`;
                }
                return `Jogo #${gameId}`;
            };

            return `
                <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:shadow-md transition-shadow duration-300 ${searchTerm ? 'ring-1 ring-blue-200 dark:ring-blue-700' : ''}">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-4">
                            <span class="text-sm font-medium text-gray-500 dark:text-gray-400">${highlightGameId(game.id)}</span>
                            <div class="flex space-x-2">
                                ${highlightNumbers(game.numbers)}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-600 dark:text-gray-400">Soma</div>
                            <div class="font-semibold text-mega-green">${game.sum}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function updatePagination() {
        const totalPages = Math.ceil(filteredGames.length / gamesPerPage);
        const container = document.getElementById('pagination');
        
        if (totalPages <= 1) {
            container.innerHTML = '';
            return;
        }

        let paginationHTML = '';
        
        // Botão anterior
        if (currentPage > 1) {
            paginationHTML += `
                <button onclick="changePage(${currentPage - 1})" 
                        class="px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
        }

        // Páginas
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);

        if (startPage > 1) {
            paginationHTML += `
                <button onclick="changePage(1)" class="px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600">1</button>
            `;
            if (startPage > 2) {
                paginationHTML += '<span class="px-3 py-2 text-gray-500">...</span>';
            }
        }

        for (let i = startPage; i <= endPage; i++) {
            const activeClass = i === currentPage ? 'bg-mega-green text-white' : 'bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600';
            paginationHTML += `
                <button onclick="changePage(${i})" 
                        class="px-3 py-2 text-sm ${activeClass} border border-gray-300 dark:border-gray-600 rounded-md">
                    ${i}
                </button>
            `;
        }

        if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
                paginationHTML += '<span class="px-3 py-2 text-gray-500">...</span>';
            }
            paginationHTML += `
                <button onclick="changePage(${totalPages})" class="px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600">${totalPages}</button>
            `;
        }

        // Botão próximo
        if (currentPage < totalPages) {
            paginationHTML += `
                <button onclick="changePage(${currentPage + 1})" 
                        class="px-3 py-2 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
        }

        container.innerHTML = paginationHTML;
    }

    function changePage(page) {
        currentPage = page;
        displayGames();
        updatePagination();
    }

    function showLoading(show) {
        document.getElementById('loading').classList.toggle('hidden', !show);
        if (!show) {
            document.getElementById('loading-progress').textContent = '';
        }
    }

    function showAlert(message) {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                <div class="flex items-center mb-4">
                    <i class="fas fa-info-circle text-mega-green text-xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Aviso</h3>
                </div>
                <p class="text-gray-700 dark:text-gray-300 mb-6">${message}</p>
                <div class="flex justify-end">
                    <button class="px-4 py-2 bg-mega-green text-white hover:bg-mega-dark-green rounded transition-colors" 
                            onclick="this.closest('.fixed').remove()">
                        OK
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }

    function showStrategyModal() {
        document.getElementById('strategy-modal').classList.remove('hidden');
    }

    function hideStrategyModal() {
        document.getElementById('strategy-modal').classList.add('hidden');
    }

    // Função para exportar para TXT
    function exportToTXT() {
        if (allGames.length === 0) {
            showAlert('Nenhum jogo foi gerado ainda!');
            return;
        }

        let txtContent = '';
        allGames.forEach(game => {
            const numbersStr = game.numbers.map(n => n.toString().padStart(2, '0')).join(' ');
            txtContent += `${numbersStr}\n`;
        });

        const blob = new Blob([txtContent], { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mega-sena-3-digitos-jogos-${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }

    // Função para exportar para XLS (CSV)
    function exportToXLS() {
        if (allGames.length === 0) {
            showAlert('Nenhum jogo foi gerado ainda!');
            return;
        }

        let csvContent = '\uFEFFNúmeros\n';
        allGames.forEach(game => {
            const numbersStr = game.numbers.map(n => n.toString().padStart(2, '0')).join(' ');
            csvContent += `"${numbersStr}"\n`;
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mega-sena-3-digitos-jogos-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
    }
</script>
</body>
</html>